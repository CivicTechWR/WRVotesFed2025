{% if site.google_analytics %}


  <script>
    if (!navigator.doNotTrack) {
      // https://stackoverflow.com/questions/3973441/conditionally-load-javascript-external-and-internal-and-keep-execution-order
      script = document.createElement('script');
      script.type = "text/javascript";
      script.src = 'https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}'
      // Ugly and increases page size. Oh well.
      document.head.appendChild(script);
    }
  </script>

  <script>
    // Respect DNT
    // This should work even if navigator.doNotTrack is not defined?
    if (!navigator.doNotTrack) { 

      // 
      // https://medium.com/swlh/how-to-use-google-tag-manager-and-google-analytics-without-cookies-7d041c73cc76
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ site.google_analytics }}', {
        'client_storage': 'none',
        'anonymize_ip': true,
        });

    }
  </script>

{% endif %}
